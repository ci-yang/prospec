# Implementation 指引

本文件提供實作階段的指引，供 **prospec-implement** Skill 參考。

---

## 實作原則

### 1. TDD Approach（如 Constitution 要求）

如果 `{{constitution_path}}` 要求 TDD（Test-Driven Development）：

1. **先寫測試：** 在實作功能前，先寫對應的單元測試
2. **紅-綠-重構循環：**
   - 紅：寫測試，確保測試失敗
   - 綠：實作最小功能讓測試通過
   - 重構：優化程式碼品質
3. **測試覆蓋率：** 確保核心邏輯有足夠的測試覆蓋

---

### 2. Task Execution Order

按照 `tasks.md` 的架構層次順序執行：

```
Types → Lib → Services → CLI → Tests
```

**依賴規則：**
- 先完成被依賴的模組（e.g., Types, Lib）
- 再實作依賴其他模組的功能（e.g., Services, CLI）
- `[P]` 標記的任務可以同時執行（無依賴關係）

**範例執行順序：**

```
1. Types/Define ErrorType enum
2. Types/Create ErrorResponse interface
3. [P] Lib/Implement BaseError class (可平行)
   [P] Lib/Implement ErrorFormatter utility (可平行)
4. Lib/Create error factory functions (依賴 BaseError)
5. Services/Integrate with API middleware (依賴 BaseError, ErrorFormatter)
```

---

### 3. Progressive Disclosure（漸進式揭露）

**只載入當前任務相關的 AI Knowledge：**

1. **開始前：** 讀取 `{{knowledge_base_path}}/_index.md` 了解整體架構
2. **執行任務時：** 只讀取相關模組的 `{{knowledge_base_path}}/modules/{module}/README.md`
3. **避免：** 一次載入所有 AI Knowledge 文件

**範例：**

執行任務 `Implement BaseError class` 時：
- 讀取 `{{knowledge_base_path}}/modules/error-handler/README.md`
- 不需要讀取 `api-middleware`, `logger` 等其他模組的 README

---

### 4. Task Completion Marking

**立即標記完成：**

在完成每個任務後，立即更新 `tasks.md` 標記為 `[x]`：

```markdown
- [x] Implement BaseError class with error code mapping ~50 lines
```

這有助於追蹤進度和避免重複工作。

---

### 5. Commit Strategy

**建議的 Commit 策略：**

- **邏輯分組：** 每完成一組相關任務後 commit
- **Commit Message 格式：**
  ```
  feat: [簡短描述] (Task ID)
  ```
  或
  ```
  test: [測試描述] (Task ID)
  ```

**範例：**

```bash
# 完成 Types 相關任務
git add src/types/error.ts
git commit -m "feat: define error types and interfaces (T001-T002)"

# 完成 Lib 相關任務
git add src/lib/error-handler.ts src/lib/error-formatter.ts
git commit -m "feat: implement error handler core logic (T003-T005)"

# 完成 Tests
git add tests/error-handler.test.ts
git commit -m "test: add unit tests for error handler (T011-T012)"
```

---

### 6. Error Handling（錯誤處理）

**如果任務失敗：**

1. **記錄 Blocker：** 在 `tasks.md` 或 Story 的 Notes 中記錄問題
2. **繼續執行：** 如果有其他獨立的任務，繼續執行
3. **回報：** 在 Story 完成時回報未完成的任務和原因

**範例：**

```markdown
## Blockers

- Task "Integrate with API middleware" blocked: API middleware module not yet merged from another branch
```

---

### 7. 程式碼品質檢查

**完成實作後：**

1. **Lint：** 執行 linter 確保程式碼風格一致
   ```bash
   npm run lint
   # 或
   bun run lint
   ```

2. **Type Check：** 執行 TypeScript 型別檢查
   ```bash
   npm run type-check
   # 或
   bun run type-check
   ```

3. **測試：** 執行測試確保功能正確
   ```bash
   npm test
   # 或
   bun test
   ```

---

## 參考資訊

- 專案名稱: `{{project_name}}`
- 技術棧: `{{tech_stack.language}}` + `{{tech_stack.framework}}`
- 套件管理: `{{tech_stack.package_manager}}`
- AI Knowledge 路徑: `{{knowledge_base_path}}`
- Constitution 檔案: `{{constitution_path}}`
