---
name: prospec-tasks
description: "Break Down Tasks | 拆解任務 - Decompose implementation plan into an actionable task checklist (tasks.md). Triggers: break down, tasks, task list, work items, how to split, 拆解, 任務清單, 工作項目, 怎麼拆"
---

# Prospec Tasks Skill

## Activation

When triggered, briefly describe in the user's language:
- That you'll read plan.md and delta-spec.md to understand the implementation scope
- Tasks will be organized by architecture layer (Types → Lib → Services → CLI → Tests)
- Each task will have complexity estimates and parallelization markers

## Startup Loading

1. Read `.prospec/changes/[name]/plan.md` — parse implementation steps
2. Read `.prospec/changes/[name]/delta-spec.md` — parse file changes and specifications
3. Read `{{constitution_path}}` — prepare test coverage check
4. **MANDATORY** — Read [`references/tasks-format.md`](references/tasks-format.md) for tasks.md format

## Core Workflow

### Phase 1: Parse Planning Documents

Auto-identify current change, read plan.md and delta-spec.md, summarize implementation phases, file changes, and spec count.

### Phase 2: Create Scaffolding

| Scenario | Action |
|----------|--------|
| tasks.md doesn't exist | Create empty `tasks.md`, update `metadata.yaml` status → `tasks` |
| Already exists | Read and populate |

### Phase 3: Decompose by Architecture Layer

Organize tasks following the layer order defined in `references/tasks-format.md`:

```
Types → Lib → Services → CLI → Tests
```

Each task format: `- [ ] [description] ~{lines} lines`. Add `[P]` marker for parallelizable tasks.

**Decomposition principles:**
- Single responsibility: one task does one thing
- Verifiable: clear completion criteria
- Right-sized: ideal 15-25 tasks, each 20-100 lines

### Phase 4: Mark Parallelization Opportunities

Identify tasks with no dependencies, mark with `[P]`. Independent tasks within the same layer are usually parallelizable.

### Phase 5: Generate Summary

Add statistics at end of file: Total Tasks, Parallelizable Tasks, Total Estimated Lines.

### Phase 6: Constitution Test Check

Ensure each new/modified module has corresponding test tasks. If coverage is insufficient, add test tasks or raise a warning.

### Phase 7: Summary + Next Steps

Suggest: `/prospec-implement` or manual review.

## NEVER

- **NEVER** produce more than 30 tasks — too many means Story scope is too large, suggest splitting
- **NEVER** create overly fine-grained tasks (<10 lines) — merge similar micro-tasks
- **NEVER** create overly coarse tasks (>200 lines) — split into verifiable steps
- **NEVER** forget to update metadata.yaml status to `tasks`
- **NEVER** start decomposition without plan.md — guide user to run `/prospec-plan` first
- **NEVER** skip test tasks — every new module must have corresponding tests
- **NEVER** forget to mark `[P]` — parallelization info is critical for implementation efficiency
- **NEVER** use S/M/L complexity markers — use `~{lines} lines` format (per tasks-format.md)

## Error Handling

| Scenario | Action |
|----------|--------|
| plan.md not found | Guide user to run `/prospec-plan` first |
| Task count exceeds 30 | Suggest splitting the Story or merging fine-grained tasks |
| Insufficient test coverage | Offer options: add test tasks / document test debt |

All generated files must be written in English.
